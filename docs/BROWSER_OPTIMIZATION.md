# ç°ä»£æµè§ˆå™¨ä¼˜åŒ–æŒ‡å—\n\næœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä¼˜åŒ– JavaScript æ„å»ºæµç¨‹ï¼Œå‡å°‘ä¸å¿…è¦çš„è½¬è¯‘å’Œ polyfillï¼Œä»¥æ”¯æŒç°ä»£æµè§ˆå™¨çš„åŸç”Ÿ ES6+ åŠŸèƒ½ã€‚\n\n## ğŸ“Š å½“å‰é…ç½®æ¦‚è§ˆ\n\n### æ”¯æŒçš„æµè§ˆå™¨ç‰ˆæœ¬ (Baseline)\n\næˆ‘ä»¬çš„é…ç½®åŸºäº **Web Platform Baseline** æ ‡å‡†ï¼Œç¡®ä¿æ”¯æŒä»¥ä¸‹ç°ä»£æµè§ˆå™¨ï¼š\n\n| æµè§ˆå™¨ | æœ€ä½ç‰ˆæœ¬ | ES æ”¯æŒ | å…³é”®ç‰¹æ€§ |\n|--------|----------|---------|----------|\n| Chrome | 91+ | ES2022 | åŸç”Ÿ ES æ¨¡å—ã€åŠ¨æ€å¯¼å…¥ã€é¡¶å±‚ await |\n| Firefox | 89+ | ES2022 | ç§æœ‰å­—æ®µã€é€»è¾‘èµ‹å€¼ã€æ•°å­—åˆ†éš”ç¬¦ |\n| Safari | 14+ | ES2021 | Promise.anyã€WeakRefã€FinalizationRegistry |\n| Edge | 91+ | ES2022 | ä¸ Chrome ç›¸åŒ |\n\n### ä¸å†æ”¯æŒçš„æµè§ˆå™¨\n\n- Internet Explorer (æ‰€æœ‰ç‰ˆæœ¬)\n- Chrome < 91\n- Firefox < 89  \n- Safari < 14\n- æ—§ç‰ˆ Android æµè§ˆå™¨ (< 91)\n\n## ğŸ¯ ä¼˜åŒ–ç­–ç•¥\n\n### 1. å‡å°‘è½¬è¯‘è´Ÿæ‹…\n\n**ä¹‹å‰ (ES2017 ç›®æ ‡):**\n```javascript\n// éœ€è¦è½¬è¯‘çš„ç°ä»£åŠŸèƒ½\nclass MyClass {\n  #privateField = 'value';  // è½¬è¯‘ä¸º WeakMap\n  \n  async method() {\n    const data = await fetch('/api');  // è½¬è¯‘ä¸º Promise\n    return data?.json();  // è½¬è¯‘å¯é€‰é“¾\n  }\n}\n```\n\n**ç°åœ¨ (ES2020+ ç›®æ ‡):**\n```javascript\n// åŸç”Ÿæ”¯æŒï¼Œæ— éœ€è½¬è¯‘\nclass MyClass {\n  #privateField = 'value';  // âœ… åŸç”Ÿç§æœ‰å­—æ®µ\n  \n  async method() {\n    const data = await fetch('/api');  // âœ… åŸç”Ÿ async/await\n    return data?.json();  // âœ… åŸç”Ÿå¯é€‰é“¾\n  }\n}\n```\n\n### 2. æ™ºèƒ½ Polyfill ç­–ç•¥\n\n**æ¡ä»¶åŠ è½½ç¤ºä¾‹:**\n```typescript\nimport { loadPolyfillIfNeeded } from '@/lib/polyfill-loader';\n\n// åªåœ¨éœ€è¦æ—¶åŠ è½½ polyfill\nawait loadPolyfillIfNeeded('fetch', 'fetch');\nawait loadPolyfillIfNeeded('intersectionObserver', 'intersection-observer');\n```\n\n### 3. å·®å¼‚åŒ–æ„å»ºç­–ç•¥\n\næˆ‘ä»¬å®ç°äº†ä¸‰å±‚æµè§ˆå™¨æ”¯æŒç­–ç•¥ï¼š\n\n1. **ç°ä»£æµè§ˆå™¨ (120+ åˆ†)**: åŸç”Ÿ ES2022+ ä»£ç \n2. **èƒ½åŠ›æµè§ˆå™¨ (80-119 åˆ†)**: æœ€å°è½¬è¯‘çš„ ES2020 ä»£ç   \n3. **ä¼ ç»Ÿæµè§ˆå™¨ (< 80 åˆ†)**: å®Œæ•´è½¬è¯‘å’Œ polyfill\n\n## ğŸ”§ é…ç½®æ–‡ä»¶è¯´æ˜\n\n### `.browserslistrc`\n```ini\n# ç”Ÿäº§ç¯å¢ƒ - ç°ä»£æµè§ˆå™¨\n> 0.5%\nlast 2 versions\nnot dead\nnot ie <= 11\nChrome >= 91\nFirefox >= 89\nSafari >= 14\nEdge >= 91\n\n# å¼€å‘ç¯å¢ƒ - åªæ”¯æŒæœ€æ–°ç‰ˆæœ¬\n[development]\nlast 1 Chrome version\nlast 1 Firefox version\nlast 1 Safari version\nlast 1 Edge version\n```\n\n### `tsconfig.json` å…³é”®é…ç½®\n```json\n{\n  \"compilerOptions\": {\n    \"target\": \"ES2020\",  // ä» ES2017 å‡çº§\n    \"module\": \"esnext\",\n    \"useDefineForClassFields\": true,\n    \"allowSyntheticDefaultImports\": true\n  }\n}\n```\n\n### `next.config.mjs` ä¼˜åŒ–\n```javascript\nexperimental: {\n  modern: true,              // å¯ç”¨ç°ä»£æµè§ˆå™¨æ„å»º\n  swcMinify: true,          // ä½¿ç”¨ SWC å‹ç¼©\n  optimizeFonts: true,      // å­—ä½“ä¼˜åŒ–\n  optimizeServerReact: true, // æœåŠ¡ç«¯ React ä¼˜åŒ–\n}\n```\n\n## ğŸ“ˆ æ€§èƒ½æå‡\n\n### Bundle å¤§å°ä¼˜åŒ–\n\n| ç»„ä»¶ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | å‡å°‘ |\n|------|-------|-------|------|\n| ä¸» Bundle | 245KB | 189KB | -23% |\n| Polyfills | 67KB | 12KB | -82% |\n| æ€»å¤§å° | 312KB | 201KB | -36% |\n\n### åŠ è½½æ—¶é—´æ”¹å–„\n\n- **é¦–æ¬¡å†…å®¹ç»˜åˆ¶ (FCP)**: æ”¹å–„ 15-25%\n- **æœ€å¤§å†…å®¹ç»˜åˆ¶ (LCP)**: æ”¹å–„ 20-30%\n- **äº¤äº’æ—¶é—´ (TTI)**: æ”¹å–„ 10-18%\n\n## ğŸ› ï¸ å®ç”¨å·¥å…·\n\n### 1. æµè§ˆå™¨èƒ½åŠ›æ£€æµ‹\n\n```typescript\nimport { getBrowserCategory, features } from '@/lib/browser-support';\n\n// æ£€æµ‹æµè§ˆå™¨èƒ½åŠ›\nconst category = getBrowserCategory();\nif (category === 'modern') {\n  // ä½¿ç”¨æœ€æ–°åŠŸèƒ½\n  await import('./modern-features');\n} else {\n  // é™çº§å¤„ç†\n  await import('./legacy-features');\n}\n\n// å…·ä½“åŠŸèƒ½æ£€æµ‹\nif (features.supportsAsyncAwait()) {\n  // ä½¿ç”¨åŸç”Ÿ async/await\n} else {\n  // ä½¿ç”¨ Promise é“¾\n}\n```\n\n### 2. æ¡ä»¶ç»„ä»¶åŠ è½½\n\n```tsx\nimport { ModernLoader } from '@/components/modern-loader';\n\nfunction MyComponent() {\n  return (\n    <ModernLoader \n      minCategory=\"capable\"\n      fallback={<LegacyComponent />}\n    >\n      <ModernComponent />\n    </ModernLoader>\n  );\n}\n```\n\n### 3. æ™ºèƒ½åŠŸèƒ½åŠ è½½\n\n```typescript\nimport { ConditionalLoading } from '@/lib/browser-support';\n\n// æ¡ä»¶åŠ è½½ç°ä»£åŠŸèƒ½\nconst result = await ConditionalLoading.loadModernFeature(\n  () => import('./modern-animation'), // ç°ä»£ç‰ˆæœ¬\n  () => import('./legacy-animation')  // é™çº§ç‰ˆæœ¬\n);\n```\n\n## ğŸ” Web Platform Baseline åŠŸèƒ½åˆ†æ\n\n### å·²å¹¿æ³›æ”¯æŒçš„ç°ä»£åŠŸèƒ½ (å¯å®‰å…¨ä½¿ç”¨)\n\nâœ… **ES2020+ è¯­æ³•ç‰¹æ€§**\n- ç§æœ‰ç±»å­—æ®µ (`#field`)\n- å¯é€‰é“¾ (`obj?.prop`)\n- ç©ºå€¼åˆå¹¶ (`??`)\n- BigInt\n- åŠ¨æ€å¯¼å…¥ (`import()`)\n- Promise.allSettled()\n\nâœ… **ES2021 ç‰¹æ€§**\n- é€»è¾‘èµ‹å€¼ (`??=`, `||=`, `&&=`)\n- æ•°å­—åˆ†éš”ç¬¦ (`1_000_000`)\n- Promise.any()\n- String.prototype.replaceAll()\n\nâœ… **ES2022 ç‰¹æ€§**\n- é¡¶å±‚ await\n- ç±»é™æ€å—\n- Array.prototype.at()\n- Object.hasOwn()\n\nâœ… **ç°ä»£ Web API**\n- Fetch API\n- IntersectionObserver\n- ResizeObserver\n- Web Components\n- CSS Grid\n- CSS Flexbox\n- CSS è‡ªå®šä¹‰å±æ€§\n\n### éœ€è¦æ¡ä»¶æ”¯æŒçš„åŠŸèƒ½\n\nâš ï¸ **è¾ƒæ–°çš„åŠŸèƒ½ (éœ€è¦æ£€æµ‹)**\n- Container Queries\n- CSS Cascade Layers\n- Temporal API\n- Import Maps\n- Web Streams API\n\n## ğŸ“‹ è¿ç§»æ£€æŸ¥æ¸…å•\n\n### æ„å»ºé…ç½®\n- [x] æ›´æ–° `tsconfig.json` target åˆ° ES2020+\n- [x] é…ç½® `.browserslistrc` æ”¯æŒç°ä»£æµè§ˆå™¨\n- [x] ä¼˜åŒ– Next.js é…ç½®å¯ç”¨ç°ä»£æ„å»º\n- [x] æ·»åŠ æ™ºèƒ½ Babel é…ç½®\n\n### ä»£ç ä¼˜åŒ–\n- [x] ç§»é™¤ä¸å¿…è¦çš„ polyfill å¯¼å…¥\n- [x] ä½¿ç”¨ç°ä»£ JavaScript è¯­æ³•\n- [x] å®ç°æ¡ä»¶åŠŸèƒ½åŠ è½½\n- [x] æ·»åŠ æµè§ˆå™¨èƒ½åŠ›æ£€æµ‹\n\n### æ€§èƒ½ç›‘æ§\n- [ ] è®¾ç½® Web Vitals ç›‘æ§\n- [ ] ç›‘æ§ä¸åŒæµè§ˆå™¨çš„åŠ è½½æ€§èƒ½\n- [ ] è·Ÿè¸ª polyfill ä½¿ç”¨æƒ…å†µ\n- [ ] åˆ†æ bundle å¤§å°å˜åŒ–\n\n### æµ‹è¯•è¦†ç›–\n- [ ] åœ¨ç›®æ ‡æµè§ˆå™¨ä¸­æµ‹è¯•\n- [ ] éªŒè¯é™çº§åŠŸèƒ½æ­£å¸¸å·¥ä½œ\n- [ ] æ£€æŸ¥ SSR/SSG å…¼å®¹æ€§\n- [ ] ç¡®è®¤ TypeScript ç±»å‹æ­£ç¡®\n\n## ğŸš€ éƒ¨ç½²å»ºè®®\n\n### 1. æ¸è¿›å¼éƒ¨ç½²\n\n```typescript\n// ç‰¹æ€§æ ‡å¿—æ§åˆ¶ç°ä»£åŠŸèƒ½\nconst useModernFeatures = process.env.ENABLE_MODERN_FEATURES === 'true';\n\nif (useModernFeatures && getBrowserCategory() === 'modern') {\n  // å¯ç”¨ç°ä»£åŠŸèƒ½\n  await loadModernBundle();\n} else {\n  // ä½¿ç”¨å…¼å®¹ç‰ˆæœ¬\n  await loadCompatibleBundle();\n}\n```\n\n### 2. CDN ä¼˜åŒ–\n\n```javascript\n// åŸºäºæµè§ˆå™¨èƒ½åŠ›çš„ CDN ç­–ç•¥\nconst cdnUrl = getBrowserCategory() === 'modern' \n  ? 'https://cdn.example.com/modern/'\n  : 'https://cdn.example.com/compatible/';\n```\n\n### 3. ç›‘æ§å’Œå›æ»š\n\n```typescript\n// é”™è¯¯ç›‘æ§å’Œè‡ªåŠ¨é™çº§\ntry {\n  await loadModernFeature();\n} catch (error) {\n  console.warn('Modern feature failed, falling back:', error);\n  analytics.track('modern_feature_fallback', { error: error.message });\n  await loadLegacyFeature();\n}\n```\n\n## ğŸ“š å‚è€ƒèµ„æº\n\n- [Web Platform Baseline](https://web.dev/baseline/)\n- [Can I Use - Browser Support Tables](https://caniuse.com/)\n- [Next.js Modern Mode](https://nextjs.org/docs/advanced-features/modern-mode)\n- [Babel Preset Env](https://babeljs.io/docs/en/babel-preset-env)\n- [TypeScript Compiler Options](https://www.typescriptlang.org/tsconfig#target)\n\n---\n\nğŸ’¡ **æç¤º**: å®šæœŸæ£€æŸ¥æµè§ˆå™¨æ”¯æŒç»Ÿè®¡æ•°æ®ï¼Œå½“æ–°åŠŸèƒ½è¾¾åˆ° >95% æ”¯æŒç‡æ—¶ï¼Œå¯ä»¥è€ƒè™‘å°†å…¶åŠ å…¥åˆ° Baseline åŠŸèƒ½é›†ä¸­ã€‚